!function(){"use strict";var e=function(){},t={},n=[],o=[];function r(t,r){var a,i,l,s,p=arguments,u=o;for(s=arguments.length;s-- >2;)n.push(p[s]);for(r&&null!=r.children&&(n.length||n.push(r.children),delete r.children);n.length;)if((i=n.pop())&&void 0!==i.pop)for(s=i.length;s--;)n.push(i[s]);else"boolean"==typeof i&&(i=null),(l="function"!=typeof t)&&(null==i?i="":"number"==typeof i?i=String(i):"string"!=typeof i&&(l=!1)),l&&a?u[u.length-1]+=i:u===o?u=[i]:u.push(i),a=l;var c=new e;return c.nodeName=t,c.children=u,c.attributes=null==r?void 0:r,c.key=null==r?void 0:r.key,c}function a(e,t){for(var n in t)e[n]=t[n];return e}function i(e,t){null!=e&&("function"==typeof e?e(t):e.current=t)}var l="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,s=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,p=[];function u(e){!e._dirty&&(e._dirty=!0)&&1==p.push(e)&&l(c)}function c(){for(var e;e=p.pop();)e._dirty&&T(e)}function h(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function f(e){var t=a({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(void 0!==n)for(var o in n)void 0===t[o]&&(t[o]=n[o]);return t}function d(e){var t=e.parentNode;t&&t.removeChild(e)}function m(e,t,n,o,r){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)i(n,null),i(o,e);else if("class"!==t||r)if("style"===t){if(o&&"string"!=typeof o&&"string"!=typeof n||(e.style.cssText=o||""),o&&"object"==typeof o){if("string"!=typeof n)for(var a in n)a in o||(e.style[a]="");for(var a in o)e.style[a]="number"==typeof o[a]&&!1===s.test(a)?o[a]+"px":o[a]}}else if("dangerouslySetInnerHTML"===t)o&&(e.innerHTML=o.__html||"");else if("o"==t[0]&&"n"==t[1]){var l=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),o?n||e.addEventListener(t,v,l):e.removeEventListener(t,v,l),(e._listeners||(e._listeners={}))[t]=o}else if("list"!==t&&"type"!==t&&!r&&t in e){try{e[t]=null==o?"":o}catch(e){}null!=o&&!1!==o||"spellcheck"==t||e.removeAttribute(t)}else{var p=r&&t!==(t=t.replace(/^xlink:?/,""));null==o||!1===o?p?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof o&&(p?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),o):e.setAttribute(t,o))}else e.className=o||""}function v(e){return this._listeners[e.type](e)}var g=[],_=0,y=!1,C=!1;function b(){for(var e;e=g.shift();)e.componentDidMount&&e.componentDidMount()}function w(e,t,n,o,r,a){_++||(y=null!=r&&void 0!==r.ownerSVGElement,C=null!=e&&!("__preactattr_"in e));var i=x(e,t,n,o,a);return r&&i.parentNode!==r&&r.appendChild(i),--_||(C=!1,a||b()),i}function x(e,t,n,o,r){var a=e,i=y;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=t&&(e.nodeValue=t):(a=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(a,e),k(e,!0))),a.__preactattr_=!0,a;var l,s,p=t.nodeName;if("function"==typeof p)return function(e,t,n,o){var r=e&&e._component,a=r,i=e,l=r&&e._componentConstructor===t.nodeName,s=l,p=f(t);for(;r&&!s&&(r=r._parentComponent);)s=r.constructor===t.nodeName;r&&s&&(!o||r._component)?(I(r,p,3,n,o),e=r.base):(a&&!l&&(B(a),e=i=null),r=M(t.nodeName,p,n),e&&!r.nextBase&&(r.nextBase=e,i=null),I(r,p,1,n,o),e=r.base,i&&e!==i&&(i._component=null,k(i,!1)));return e}(e,t,n,o);if(y="svg"===p||"foreignObject"!==p&&y,p=String(p),(!e||!h(e,p))&&(l=p,(s=y?document.createElementNS("http://www.w3.org/2000/svg",l):document.createElement(l)).normalizedNodeName=l,a=s,e)){for(;e.firstChild;)a.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(a,e),k(e,!0)}var u=a.firstChild,c=a.__preactattr_,v=t.children;if(null==c){c=a.__preactattr_={};for(var g=a.attributes,_=g.length;_--;)c[g[_].name]=g[_].value}return!C&&v&&1===v.length&&"string"==typeof v[0]&&null!=u&&void 0!==u.splitText&&null==u.nextSibling?u.nodeValue!=v[0]&&(u.nodeValue=v[0]):(v&&v.length||null!=u)&&function(e,t,n,o,r){var a,i,l,s,p,u=e.childNodes,c=[],f={},m=0,v=0,g=u.length,_=0,y=t?t.length:0;if(0!==g)for(var C=0;C<g;C++){var b=u[C],w=b.__preactattr_,N=y&&w?b._component?b._component.__key:w.key:null;null!=N?(m++,f[N]=b):(w||(void 0!==b.splitText?!r||b.nodeValue.trim():r))&&(c[_++]=b)}if(0!==y)for(var C=0;C<y;C++){s=t[C],p=null;var N=s.key;if(null!=N)m&&void 0!==f[N]&&(p=f[N],f[N]=void 0,m--);else if(v<_)for(a=v;a<_;a++)if(void 0!==c[a]&&(S=i=c[a],U=r,"string"==typeof(M=s)||"number"==typeof M?void 0!==S.splitText:"string"==typeof M.nodeName?!S._componentConstructor&&h(S,M.nodeName):U||S._componentConstructor===M.nodeName)){p=i,c[a]=void 0,a===_-1&&_--,a===v&&v++;break}p=x(p,s,n,o),l=u[C],p&&p!==e&&p!==l&&(null==l?e.appendChild(p):p===l.nextSibling?d(l):e.insertBefore(p,l))}var S,M,U;if(m)for(var C in f)void 0!==f[C]&&k(f[C],!1);for(;v<=_;)void 0!==(p=c[_--])&&k(p,!1)}(a,v,n,o,C||null!=c.dangerouslySetInnerHTML),function(e,t,n){var o;for(o in n)t&&null!=t[o]||null==n[o]||m(e,o,n[o],n[o]=void 0,y);for(o in t)"children"===o||"innerHTML"===o||o in n&&t[o]===("value"===o||"checked"===o?e[o]:n[o])||m(e,o,n[o],n[o]=t[o],y)}(a,t.attributes,c),y=i,a}function k(e,t){var n=e._component;n?B(n):(null!=e.__preactattr_&&i(e.__preactattr_.ref,null),!1!==t&&null!=e.__preactattr_||d(e),N(e))}function N(e){for(e=e.lastChild;e;){var t=e.previousSibling;k(e,!0),e=t}}var S=[];function M(e,t,n){var o,r=S.length;for(e.prototype&&e.prototype.render?(o=new e(t,n),L.call(o,t,n)):((o=new L(t,n)).constructor=e,o.render=U);r--;)if(S[r].constructor===e)return o.nextBase=S[r].nextBase,S.splice(r,1),o;return o}function U(e,t,n){return this.constructor(e,n)}function I(e,n,o,r,a){e._disable||(e._disable=!0,e.__ref=n.ref,e.__key=n.key,delete n.ref,delete n.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||a?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(n,r)),r&&r!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=r),e.prevProps||(e.prevProps=e.props),e.props=n,e._disable=!1,0!==o&&(1!==o&&!1===t.syncComponentUpdates&&e.base?u(e):T(e,1,a)),i(e.__ref,e))}function T(e,t,n,o){if(!e._disable){var r,i,l,s=e.props,p=e.state,u=e.context,c=e.prevProps||s,h=e.prevState||p,d=e.prevContext||u,m=e.base,v=e.nextBase,y=m||v,C=e._component,x=!1,N=d;if(e.constructor.getDerivedStateFromProps&&(p=a(a({},p),e.constructor.getDerivedStateFromProps(s,p)),e.state=p),m&&(e.props=c,e.state=h,e.context=d,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(s,p,u)?x=!0:e.componentWillUpdate&&e.componentWillUpdate(s,p,u),e.props=s,e.state=p,e.context=u),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!x){r=e.render(s,p,u),e.getChildContext&&(u=a(a({},u),e.getChildContext())),m&&e.getSnapshotBeforeUpdate&&(N=e.getSnapshotBeforeUpdate(c,h));var S,U,L=r&&r.nodeName;if("function"==typeof L){var W=f(r);(i=C)&&i.constructor===L&&W.key==i.__key?I(i,W,1,u,!1):(S=i,e._component=i=M(L,W,u),i.nextBase=i.nextBase||v,i._parentComponent=e,I(i,W,0,u,!1),T(i,1,n,!0)),U=i.base}else l=y,(S=C)&&(l=e._component=null),(y||1===t)&&(l&&(l._component=null),U=w(l,r,u,n||!m,y&&y.parentNode,!0));if(y&&U!==y&&i!==C){var O=y.parentNode;O&&U!==O&&(O.replaceChild(U,y),S||(y._component=null,k(y,!1)))}if(S&&B(S),e.base=U,U&&!o){for(var P=e,j=e;j=j._parentComponent;)(P=j).base=U;U._component=P,U._componentConstructor=P.constructor}}for(!m||n?g.push(e):x||e.componentDidUpdate&&e.componentDidUpdate(c,h,N);e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);_||o||b()}}function B(e){var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?B(n):t&&(null!=t.__preactattr_&&i(t.__preactattr_.ref,null),e.nextBase=t,d(t),S.push(e),N(t)),i(e.__ref,null)}function L(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{},this._renderCallbacks=[]}a(L.prototype,{setState:function(e,t){this.prevState||(this.prevState=this.state),this.state=a(a({},this.state),"function"==typeof e?e(this.state,this.props):e),t&&this._renderCallbacks.push(t),u(this)},forceUpdate:function(e){e&&this._renderCallbacks.push(e),T(this,2)},render:function(){}});var W={invert:{label:"Invert",fn:"invert"},grayscale:{label:"Grayscale",fn:"grayscale"},red:{label:"Red",fn:"red"},red2:{label:"Other Red",fn:"red2"},green:{label:"Green",fn:"green"},green2:{label:"Other Green",fn:"green2"},blue:{label:"Blue",fn:"blue"},blue2:{label:"Other Blue",fn:"blue2"},distance3d:{label:"Custom Colour",fn:"distance3d"}};function O(e){if(!e.prototype||!e.prototype.render)return e.__scuWrap||(e.__scuWrap=(t=e,(n=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(P)).prototype.renderChild=t,n));var t,n;e.prototype.shouldComponentUpdate=j}var P=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.shouldComponentUpdate=function(e){return R(e,this.props)},t.prototype.render=function(e,t,n){return this.renderChild(e,n)},t}(L);function j(e,t){return R(e,this.props)||R(t,this.state)}function R(e,t){for(var n in e)if(e[n]!==t[n])return!0;for(var o in t)if(!(o in e))return!0;return!1}var D=O(function(e){return r("select",{value:e.value,onChange:e.onChange},Object.keys(W).map(function(e){return r("option",{value:e,key:e},W[e].label)}))}),F=O(function(e){return r("input",{type:"color",value:e.value,onChange:e.onChange})}),E=O(function(e){return r("label",null,"Threshold: ",r("input",{type:"range",id:"threshold",min:e.min,max:e.max,value:e.value,onChange:e.onChange}),e.value)});function V(e){return function(t){var n=t.target;e(function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),o=e.width,r=e.height;return t.width=o,t.height=r,n.drawImage(e,0,0),n.getImageData(0,0,o,r)}(n)),URL.revokeObjectURL(n.src)}}function A(e){return function(t){var n=t.target.files[0];n&&(e.src=URL.createObjectURL(n))}}var G=O(function(e){var t=new Image;return t.onload=V(e.onChange),r("input",{type:"file",onChange:A(t)})});var H=O(function(e){return r("form",{onSubmit:function(e){return e.preventDefault()},style:{display:"flex",flexWrap:"wrap"}},r(G,{onChange:e.onImageChange}),r(D,{value:e.filter,onChange:e.onFilterChange}),(t=e.showColor,n=e.color,o=e.onColorChange,!0===t?r(F,{value:n,onChange:o}):null),r(E,{min:e.thresholdMin,max:e.thresholdMax,value:e.threshold,onChange:e.onThresholdChange}));var t,n,o});var z=function(e){function t(t){e.call(this,t);this.worker=function(e){if(window.Worker){var t=new Worker("dist/web-worker.js");return t.onmessage=e.onmessage,t.onerror=e.onerror,t}}({onmessage:this.onMessage.bind(this),onerror:function(e){return console.log(e)}})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(e){return this.postMessage(e.image,e.filter,e.color,e.threshold),null},t.prototype.componentWillUnmount=function(){this.worker&&this.worker.terminate()},t.prototype.shouldComponentUpdate=function(e){return R(this.props,e)},t.prototype.postMessage=function(e,t,n,o){null!==e&&this.worker.postMessage([e,t,n,o,this.timestamp=performance.now()])},t.prototype.onMessage=function(e){this.timestamp===e.data[4]&&this.props.onFilterImage(e.data[0])},t}(L),$=O(function(e){return r("canvas",{ref:e.getRef,style:{maxWidth:"100%",height:"auto"}})});var q,J,K,Q=function(e){function t(t){var n=this;e.call(this,t),this.getRef=function(e){return n.canvas=e}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(){return r($,{getRef:this.getRef})},t.prototype.componentDidUpdate=function(){var e,t,n;e=this.canvas,t=this.props.image,n=e.getContext("2d"),t&&(e.width!==t.width&&(e.width=t.width),e.height!==t.height&&(e.height=t.height),n.putImageData(t,0,0))},t}(L),X=function(e,t){return function(n){return e.setState(function(e){var o={};switch(t){case"filter":var r=n.target.value,a="distance3d"===r;o.filter=r,o.threshold=a?382:8,o.thresholdMax=a?765:255,o.showColor=a;break;case"filteredImage":case"image":o[t]=n;break;default:o[t]=n.target.value}return Object.assign({},e,o)})}},Y=function(e){function t(t){e.call(this,t);var n=this;n.state={image:null,filter:null,filteredImage:null,color:"#ffff00",showColor:!1,threshold:8,thresholdMin:0,thresholdMax:255},n.onImageChange=X(n,"image"),n.onFilterChange=X(n,"filter"),n.onColorChange=X(n,"color"),n.onThresholdChange=X(n,"threshold"),n.onFilterImage=X(n,"filteredImage")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(e,t){var n=this;return r("div",null,r(H,{filter:t.filter,color:t.color,showColor:t.showColor,threshold:t.threshold,thresholdMin:t.thresholdMin,thresholdMax:t.thresholdMax,onFilterChange:n.onFilterChange,onImageChange:n.onImageChange,onColorChange:n.onColorChange,onThresholdChange:n.onThresholdChange}),r(Q,{image:t.filteredImage}),r(z,{image:t.image,filter:t.filter,color:t.color,threshold:t.threshold,onFilterImage:n.onFilterImage}))},t}(L);q=r(Y,null),J=document.getElementById("root"),w(K,q,{},!1,J,!1)}();
//# sourceMappingURL=app.js.map
