"use strict";function calculateHue(e,r,a){var t,n=e/255,c=r/255,u=a/255,s=Math.min(n,c,u),o=Math.max(n,c,u);if(s==o)t=0;else{var l=o-s;switch(o){case n:t=(c<u?6:0)+(c-u)/l;break;case c:t=2+(u-n)/l;break;case u:t=4+(n-c)/l}t=60*(t<0?360+t:t)}return t}function invert(e){var r=0,a=e.length;for(r=0;r<a;r++)e[r]=(r+1)%4==0?e[r]:255-e[r];return e}function grayscale(e){for(var r=e.length,a=0;a<r;a+=4){var t=(e[a]+e[a+1]+e[a+2])/3;e[a]=e[a+1]=e[a+2]=t}return e}function red(e){var r,a,t;for(a=0,t=e.length;a<t;a+=4)r=(e[a]+e[a+1]+e[a+2])/3,e[a]=e[a]>r?e[a]:r,e[a+1]=e[a+2]=r;return e}function red2(e,r){var a=e.length;r|=0;for(var t=0;t<a;t+=4){var n=e[t],c=e[t+1],u=e[t+2];(n<=c+r||n<=u+r)&&(e[t]=e[t+1]=e[t+2]=(n+c+u)/3)}return e}function green(e){var r,a,t;for(a=0,t=e.length;a<t;a+=4)r=(e[a]+e[a+1]+e[a+2])/3,e[a+1]=e[a+1]>r?e[a+1]:r,e[a]=e[a+2]=r;return e}function green2(e,r){var a=e.length;r|=0;for(var t=0;t<a;t+=4){var n=e[t],c=e[t+1],u=e[t+2];(c<=n+r||c<=u+r)&&(e[t]=e[t+1]=e[t+2]=(n+c+u)/3)}return e}function blue(e){var r,a,t;for(a=0,t=e.length;a<t;a+=4)r=(e[a]+e[a+1]+e[a+2])/3,e[a+2]<r&&(e[a]=e[a+1]=e[a+2]=r);return e}function blue2(e,r){var a=e.length;r|=0;for(var t=0;t<a;t+=4){var n=e[t],c=e[t+1],u=e[t+2];(u<=n+r||u<=c+r)&&(e[t]=e[t+1]=e[t+2]=(n+c+u)/3)}return e}function distance3d(e,r,a){var t,n,c,u,s,o,l,i;for(u=0,s=e.length;u<s;u+=4){t=e[u],n=e[u+1],c=e[u+2],o=Math.pow(r[0]-t,2),l=Math.pow(r[1]-n,2),i=Math.pow(r[2]-c,2),Math.sqrt(2*o+4*l+3*i+(r[0]+t)*(o-i)/512)>a&&(e[u]=e[u+1]=e[u+2]=(t+n+c)/3)}return e}function contrast(e,r){for(var a=(0|r)/256,t=0,n=e.length;t<n;t+=4){var c=e[t],u=e[t+1],s=e[t+2],o=1+((c+u+s)/3<128?-1:1)*a;e[t]=c*o,e[t+1]=u*o,e[t+2]=s*o}return e}function hue(e,r,a){for(var t=calculateHue(r[0],r[1],r[2]),n=0,c=e.length;n<c;n+=4){var u=e[n],s=e[n+1],o=e[n+2];Math.abs(calculateHue(u,s,o)-t)>a&&(e[n]=e[n+1]=e[n+2]=(u+s+o)/3)}return e}function hex2rgb(e){var r=(e||"#000000").toString().replace("#",""),a=r.length/3;return[0,1,2].map(function(e){var t=r.substr(e*a,a);return parseInt(1===a?t+t:t,16)})}onmessage=function(e){console.time("filter");var r=e.data,a=r[0].data,t=r[1],n=r[2],c=0|r[3];switch(t){case"invert":invert(a);break;case"grayscale":grayscale(a);break;case"red":red(a);break;case"red2":red2(a,c);break;case"green":green(a);break;case"green2":green2(a,c);break;case"blue":blue(a);break;case"blue2":blue2(a,c);break;case"distance3d":distance3d(a,hex2rgb(n),c);break;case"contrast":contrast(a,c);break;case"hue":hue(a,hex2rgb(n),c)}console.timeEnd("filter"),postMessage(e.data)};
