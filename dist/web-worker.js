"use strict";function r2R(r){var e=r/255;return e>.04045?100*Math.pow((e+.055)/1.055,2.4):e/12.92*100}function RGB2XYZ(r){var e=r2R(r[0]),n=r2R(r[1]),t=r2R(r[2]);return{X:.4124*e+.3576*n+.1805*t,Y:.2126*e+.7152*n+.0722*t,Z:.0193*e+.1192*n+.9505*t}}function x2X(r){return r>.008856?Math.pow(r,1/3):7.787*r+16/116}function XYZ2LAB(r,e,n){var t=x2X(r/95.047),a=x2X(e/100);return{L:116*a-16,a:500*(t-a),b:200*(a-x2X(n/108.883))}}function RGB2LAB(r){var e=RGB2XYZ(r);return XYZ2LAB(e.X,e.Y,e.Z)}function CIE76Lab(r,e){var n=r.L-e.L,t=r.a-e.a,a=r.b-e.b;return Math.sqrt(Math.pow(n,2)+Math.pow(t,2)+Math.pow(a,2))}var THRESHOLD=8;function invert(r){var e=0,n=r.length;for(e=0;e<n;e++)r[e]=(e+1)%4==0?r[e]:255-r[e];return r}function grayscale(r){var e,n,t=r.length;for(e=0;e<t;e+=4)n=(r[e]+r[e+1]+r[e+2])/3,r[e]=r[e+1]=r[e+2]=n;return r}function red(r){var e,n,t;for(n=0,t=r.length;n<t;n+=4)e=(r[n]+r[n+1]+r[n+2])/3,r[n]=r[n]>e?r[n]:e,r[n+1]=r[n+2]=e;return r}function red2(r){var e,n,t,a,o,u;for(o=0,u=r.length;o<u;o+=4)a=((e=r[o])+(n=r[o+1])+(t=r[o+2]))/3,(e<n+THRESHOLD||e<t+THRESHOLD)&&(r[o]=r[o+1]=r[o+2]=a);return r}function green(r){var e,n,t;for(n=0,t=r.length;n<t;n+=4)e=(r[n]+r[n+1]+r[n+2])/3,r[n+1]=r[n+1]>e?r[n+1]:e,r[n]=r[n+2]=e;return r}function green2(r){var e,n,t,a,o,u;for(o=0,u=r.length;o<u;o+=4)a=((e=r[o])+(n=r[o+1])+(t=r[o+2]))/3,(n<e+THRESHOLD||n<t+THRESHOLD)&&(r[o]=r[o+1]=r[o+2]=a);return r}function blue(r){var e,n,t;for(n=0,t=r.length;n<t;n+=4)e=(r[n]+r[n+1]+r[n+2])/3,r[n+2]<e&&(r[n]=r[n+1]=r[n+2]=e);return r}function blue2(r){var e,n,t,a,o,u;for(o=0,u=r.length;o<u;o+=4)a=((e=r[o])+(n=r[o+1])+(t=r[o+2]))/3,(t<e+THRESHOLD||t<n+THRESHOLD)&&(r[o]=r[o+1]=r[o+2]=a);return r}function customColor(r,e){var n=RGB2LAB([0|r[0],0|r[1],0|r[2]]),t=0|e;return function(r){var e,a,o,u,c;for(u=0,c=r.length;u<c;u+=4)e=r[u],a=r[u+1],o=r[u+2],CIE76Lab(n,RGB2LAB([e,a,o]))>t&&(r[u]=r[u+1]=r[u+2]=(e+a+o)/3);return r}}onmessage=function(r){console.time("filter");var e=r.data[1].data;switch(r.data[0]){case"invert":invert(e);break;case"grayscale":grayscale(e);break;case"red":red(e);break;case"red2":red2(e);break;case"green":green(e);break;case"green2":green2(e);break;case"blue":blue(e);break;case"blue2":blue2(e);break;case"customColor":customColor([255,255,0],100)(e)}console.timeEnd("filter"),postMessage(r.data)};
