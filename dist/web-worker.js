"use strict";function calculateHue(e,r,a){var t,n=e/255,c=r/255,s=a/255,u=Math.min(n,c,s),i=Math.max(n,c,s);if(u==i)t=0;else{var h=i-u;switch(i){case n:t=(c<s?6:0)+(c-s)/h;break;case c:t=2+(s-n)/h;break;case s:t=4+(n-c)/h}t=60*(t<0?360+t:t)}return t}function rgb2hsl(e,r,a){var t=e/255,n=r/255,c=a/255,s=Math.min(t,n,c),u=Math.max(t,n,c),i=(u+s)/2,h=0===u||1===s?0:(u-i)/Math.min(i,1-i),o=0;if(s!==u){var l=u-s;switch(u){case t:o=(n<c?6:0)+(n-c)/l;break;case n:o=2+(c-t)/l;break;case c:o=4+(t-n)/l}o=60*(o<0?360+o:o)}return[o,h,i]}function invert(e){var r=0,a=e.length;for(r=0;r<a;r++)e[r]=(r+1)%4==0?e[r]:255-e[r];return e}function grayscale(e){for(var r=e.length,a=0;a<r;a+=4){var t=(e[a]+e[a+1]+e[a+2])/3;e[a]=e[a+1]=e[a+2]=t}return e}function red(e){var r,a,t;for(a=0,t=e.length;a<t;a+=4)r=(e[a]+e[a+1]+e[a+2])/3,e[a]=e[a]>r?e[a]:r,e[a+1]=e[a+2]=r;return e}function green(e){var r,a,t;for(a=0,t=e.length;a<t;a+=4)r=(e[a]+e[a+1]+e[a+2])/3,e[a+1]=e[a+1]>r?e[a+1]:r,e[a]=e[a+2]=r;return e}function blue(e){var r,a,t;for(a=0,t=e.length;a<t;a+=4)r=(e[a]+e[a+1]+e[a+2])/3,e[a+2]<r&&(e[a]=e[a+1]=e[a+2]=r);return e}function hue(e,r,a){for(var t=calculateHue(r[0],r[1],r[2]),n=(t-a+360)%360,c=(t+a+360)%360,s=n>c,u=0,i=e.length;u<i;u+=4){var h=e[u],o=e[u+1],l=e[u+2],f=calculateHue(h,o,l);(s?f<=n&&f>=c:f<n||f>c)&&(e[u]=e[u+1]=e[u+2]=(h+o+l)/3)}return e}function hsl2rgb(e,r,a){var t,n,c,s=2*a,u=e/60%2,i=(s>1?2-s:s)*r*255,h=(u>1?2-u:u)*i,o=255*a-i/2;switch(e/60|0){case 0:t=i,n=h,c=0;break;case 1:t=h,n=i,c=0;break;case 2:t=0,n=i,c=h;break;case 3:t=0,n=h,c=i;break;case 4:t=h,n=0,c=i;break;case 5:t=i,n=0,c=h;break;default:t=n=c=0}return[t+o,n+o,c+o]}function saturation(e,r){for(var a=0,t=e.length;a<t;a+=4){var n=rgb2hsl(e[a],e[a+1],e[a+2]),c=n[1]+r,s=hsl2rgb(n[0],c>1?1:c<0?0:c,n[2]);e[a]=s[0],e[a+1]=s[1],e[a+2]=s[2]}return e}function lightness(e,r){for(var a=0,t=e.length;a<t;a+=4){var n=rgb2hsl(e[a],e[a+1],e[a+2]),c=n[2]+r,s=hsl2rgb(n[0],n[1],c>1?1:c<0?0:c);e[a]=s[0],e[a+1]=s[1],e[a+2]=s[2]}return e}function lightness$1(e,r){for(var a=0,t=e.length;a<t;a+=4){var n=rgb2hsl(e[a],e[a+1],e[a+2]),c=hsl2rgb((360+n[0]+r)%360,n[1],n[2]);e[a]=c[0],e[a+1]=c[1],e[a+2]=c[2]}return e}function pixelate(e,r){r|=0;for(var a=e.width,t=e.height,n=e.data,c=0;c<t;c+=r)for(var s=function(e){for(var t=[],s=[],u=[],i=[],h=0;h<r;h++)for(var o=0;o<r;o++){var l=4*(e+h+(c+o)*a);void 0!==n[l]&&(t.push(l),s.push(n[l]),u.push(n[l+1]),i.push(n[l+2]))}var f=s.length,b=s.reduce(function(e,r){return e+r},0)/f,g=u.reduce(function(e,r){return e+r},0)/f,v=i.reduce(function(e,r){return e+r},0)/f;t.forEach(function(e){n[e]=b,n[e+1]=g,n[e+2]=v})},u=0;u<a;u+=r)s(u);return n}onmessage=function(e){console.time("filter");var r=e.data,a=r[0].data;switch(r[1]){case"INVERT":invert(a);break;case"GRAYSCALE":grayscale(a);break;case"RED_TONE":red(a);break;case"RED":hue(a,[255,0,0],45);break;case"GREEN_TONE":green(a);break;case"GREEN":hue(a,[0,255,0],75);break;case"BLUE_TONE":blue(a);break;case"BLUE":hue(a,[0,0,255],60);break;case"HUE":lightness$1(a,-30);break;case"SATURATION":saturation(a,.2);break;case"LIGHTNESS":lightness(a,.2);break;case"PIXELATE":pixelate(r[0],10)}postMessage(e.data),console.timeEnd("filter")};
